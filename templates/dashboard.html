<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Advisor Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* --- CSS VARIABLES --- */
        :root {
            --bg-color: #FFFDF6;
            --card-bg: #E2D4E0;
            --border-color: #949AB1;
            --icon-label: #7C7E9D;
            --primary-text: #4C5372;
            --accent-color: #4C5372;
            --hover-shadow: rgba(76, 83, 114, 0.15);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        html { scroll-behavior: smooth; }

        body { 
            font-family: 'Montserrat', sans-serif; 
            background: var(--bg-color); 
            min-height: 100vh; 
            padding-bottom: 40px; 
            color: var(--primary-text);
            overflow-x: hidden;
        }

        /* Full Width Header */
        .header { 
            background: var(--card-bg); 
            box-shadow: 0 4px 20px var(--hover-shadow); 
            position: sticky; top: 0; z-index: 100; 
            border-bottom: 1px solid var(--border-color);
            padding: 15px 40px;
            animation: slideDown 0.6s ease;
        }
        @keyframes slideDown { from { transform: translateY(-100%); } to { transform: translateY(0); } }

        .header-content { 
            width: 100%; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
        }

        .logo { 
            font-size: 28px; 
            font-weight: 800; 
            color: var(--primary-text); 
            letter-spacing: -1px; 
            cursor: pointer;
            transition: transform 0.3s ease;
        }
        .logo:hover { transform: scale(1.05); }

        .header-right { display: flex; align-items: center; gap: 20px; }
        .user-name { font-size: 15px; color: var(--primary-text); font-weight: 600; }

        .profile-icon { 
            width: 45px; height: 45px; 
            background: var(--primary-text); 
            border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 10px rgba(76, 83, 114, 0.3); 
        }
        .profile-icon:hover { transform: rotate(360deg) scale(1.1); }
        .profile-icon svg { width: 24px; height: 24px; fill: var(--bg-color); }

        /* Full Screen Grid Layout */
        .dashboard-container { 
            width: 100%;
            padding: 30px 40px; 
            display: grid; 
            grid-template-columns: repeat(12, 1fr); 
            gap: 30px; 
            animation: fadeIn 0.8s ease;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .widget { 
            background: var(--card-bg); 
            border-radius: 20px; 
            padding: 30px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.03); 
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
            border: 1px solid var(--border-color); 
            position: relative;
            overflow: hidden;
        }
        .widget:hover { transform: translateY(-8px); box-shadow: 0 15px 35px rgba(76, 83, 114, 0.2); border-color: var(--primary-text); }

        .widget-title { 
            font-size: 22px; 
            font-weight: 700; 
            color: var(--primary-text); 
            margin-bottom: 25px; 
            position: relative; 
            display: inline-block;
        }
        .widget-title::after { 
            content: ''; position: absolute; bottom: -5px; left: 0; width: 50px; height: 3px; 
            background: var(--border-color); border-radius: 2px; 
        }

        /* Activity Feed */
        .activity-feed { grid-column: 1 / 7; min-height: 350px; }
        .activity-list { display: flex; flex-direction: column; gap: 15px; }
        .activity-item { 
            display: flex; gap: 15px; align-items: flex-start; padding: 15px; 
            border-radius: 12px; transition: all 0.3s ease; cursor: pointer; 
            background: rgba(255,255,255,0.3);
            border-left: 3px solid transparent;
        }
        .activity-item:hover { 
            background: rgba(255,255,255,0.6); 
            transform: translateX(5px); 
            border-left-color: var(--primary-text);
        }
        .activity-icon { font-size: 24px; color: var(--icon-label); }
        .activity-text { font-size: 15px; font-weight: 600; color: var(--primary-text); margin-bottom: 4px; }
        .activity-time { font-size: 12px; color: var(--icon-label); font-weight: 500; }

        /* Talk to Orion */
        .talk-to-orion { 
            grid-column: 7 / 13; 
            background: var(--primary-text); 
            color: var(--bg-color); 
            cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; 
            min-height: 350px; 
            border: 1px solid var(--primary-text);
        }
        .talk-to-orion:hover { background: #3E445B; } /* Slightly darker shade */
        .talk-to-orion .widget-title { color: var(--bg-color); }
        .talk-to-orion .widget-title::after { background: var(--border-color); }
        .orion-icon { font-size: 70px; margin-bottom: 15px; animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
        .orion-description { font-size: 18px; opacity: 0.9; margin-bottom: 20px; font-weight: 500; color: var(--card-bg); }
        .orion-arrow { font-size: 36px; font-weight: bold; color: var(--bg-color); transition: transform 0.3s; }
        .talk-to-orion:hover .orion-arrow { transform: translateX(10px); }

        /* Skills Gap */
        .skills-gap { grid-column: 1 / 13; min-height: 300px; }
        .skills-content { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 30px; }
        .skills-subtitle { font-size: 16px; font-weight: 700; color: var(--icon-label); margin-bottom: 15px; text-transform: uppercase; letter-spacing: 1px; }
        .skill-tags { display: flex; flex-wrap: wrap; gap: 12px; }
        
        .skill-tag { padding: 8px 18px; border-radius: 25px; font-size: 14px; font-weight: 600; border: 1px solid var(--border-color); transition: transform 0.2s; }
        .skill-tag:hover { transform: scale(1.05); }
        .skill-tag.mastered { background: var(--primary-text); color: var(--bg-color); border-color: var(--primary-text); }
        .skill-tag.learning { background: transparent; color: var(--primary-text); border-color: var(--primary-text); border-width: 2px; }
        
        .btn-primary { 
            padding: 14px 32px; 
            background: var(--primary-text); 
            color: var(--bg-color); 
            border: none; border-radius: 30px; cursor: pointer; 
            font-size: 16px; font-weight: 700; 
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(76, 83, 114, 0.2);
        }
        .btn-primary:hover { background: #3E445B; transform: translateY(-2px); box-shadow: 0 6px 20px rgba(76, 83, 114, 0.3); }

        /* World Chat */
        .world-chat-widget { 
            grid-column: 1 / 13; min-height: 180px; cursor: pointer; 
            display: flex; align-items: center; justify-content: space-between; gap: 30px; 
            background: var(--card-bg);
            border: 2px solid var(--primary-text); 
        }
        .world-chat-widget:hover { background: #dcd0da; }
        .wc-content { flex: 1; z-index: 1; }
        .wc-icon { font-size: 60px; animation: spinEarth 20s linear infinite; }
        @keyframes spinEarth { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .wc-arrow { font-size: 30px; color: var(--primary-text); font-weight: 800; transition: transform 0.3s; }
        .world-chat-widget:hover .wc-arrow { transform: translateX(10px); }

        @media (max-width: 1024px) {
            .activity-feed, .talk-to-orion, .skills-gap, .world-chat-widget { grid-column: 1 / 13; }
            .skills-content { grid-template-columns: 1fr; }
            .dashboard-container { padding: 20px; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1 class="logo" onclick="window.location.href='/dashboard'">Career Advisor</h1>
            <div class="header-right">
                <span class="user-name">Welcome, User</span>
                <div class="profile-icon" id="profileIcon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        <div class="widget activity-feed">
            <h2 class="widget-title">Recent Activity</h2>
            <div class="activity-list"></div>
        </div>

        <div class="widget talk-to-orion" id="talkToOrion">
            <div class="orion-icon">ü§ñ</div>
            <h2 class="widget-title">Talk to Orion</h2>
            <p class="orion-description">Get personalized career guidance & chat now</p>
            <div class="orion-arrow">‚Üí</div>
        </div>

        <div class="widget skills-gap">
            <h2 class="widget-title">Skills Gap Analysis</h2>
            <div class="skills-content">
                <div class="skills-column">
                    <h3 class="skills-subtitle">Skills You Have</h3>
                    <div class="skill-tags" id="skillsHaveContainer"></div>
                </div>
                <div class="skills-column">
                    <h3 class="skills-subtitle">Currently Learning Skills</h3>
                    <div class="skill-tags" id="skillsLearningContainer"></div>
                </div>
            </div>
            <button class="btn-primary" onclick="window.location.href='/detailed-skill-analysis'">View Detailed Analysis</button>
        </div>

        <div class="widget world-chat-widget" onclick="window.location.href='/world-chat'">
            <div class="wc-icon">üåç</div>
            <div class="wc-content">
                <h2 class="widget-title" style="margin-bottom: 8px;">World Chat</h2>
                <p style="color: var(--primary-text); font-weight: 500; font-size: 16px;">Connect with the global community of learners and professionals.</p>
            </div>
            <div class="wc-arrow">‚Üí</div>
        </div>
    </div>

    <script>
        function timeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " years ago";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " months ago";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " days ago";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " hours ago";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " minutes ago";
            return "Just now";
        }

        async function loadDashboard() {
            try {
                const response = await fetch('/api/dashboard-data');
                if (response.status === 401) { window.location.href = '/auth'; return; }
                if (response.ok) {
                    const data = await response.json();
                    
                    document.querySelector('.user-name').textContent = `Welcome, ${data.name}`;

                    const skillsHave = document.getElementById('skillsHaveContainer');
                    skillsHave.innerHTML = data.skills.map(s => `<span class="skill-tag mastered">${s}</span>`).join('') || '<span style="color:var(--icon-label);font-size:14px;">No skills added</span>';

                    const skillsLearning = document.getElementById('skillsLearningContainer');
                    skillsLearning.innerHTML = data.currently_learning.map(s => `<span class="skill-tag learning">${s}</span>`).join('') || '<span style="color:var(--icon-label);font-size:14px;">Not learning anything</span>';

                    const activityList = document.querySelector('.activity-list');
                    if (data.recent_activity.length > 0) {
                        activityList.innerHTML = data.recent_activity.map(a => `
                            <div class="activity-item" onclick="window.location.href='/chat?id=${a.id}'">
                                <div class="activity-icon">üí¨</div>
                                <div class="activity-details">
                                    <p class="activity-text">Chat: ${a.title}</p>
                                    <span class="activity-time">${timeAgo(a.timestamp)}</span>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        activityList.innerHTML = '<div style="padding:15px; color:var(--icon-label); font-style: italic;">No recent activity found. Start a chat with Orion!</div>';
                    }
                }
            } catch (error) { console.error("Error loading dashboard:", error); }
        }

        window.addEventListener('load', () => { loadDashboard(); });
        document.getElementById('profileIcon').addEventListener('click', () => window.location.href = '/profile');
        document.getElementById('talkToOrion').addEventListener('click', () => window.location.href = '/chat');
    </script>
</body>
</html>