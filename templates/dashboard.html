<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Advisor Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ... (Core Styles) ... */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Montserrat', sans-serif; background: linear-gradient(135deg, #CC313D 0%, #F7C5CC 100%); min-height: 100vh; padding-bottom: 40px; animation: gradientShift 15s ease infinite; background-size: 200% 200%; }
        @keyframes gradientShift { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        
        /* Header */
        .header { background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(204, 49, 61, 0.15); position: sticky; top: 0; z-index: 100; animation: slideDown 0.6s ease; }
        @keyframes slideDown { from { transform: translateY(-100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .header-content { max-width: 1400px; margin: 0 auto; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; }
        .logo { font-size: 28px; font-weight: 800; background: linear-gradient(135deg, #CC313D 0%, #F7C5CC 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; letter-spacing: -1px; animation: pulse 3s ease-in-out infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }
        .header-right { display: flex; align-items: center; gap: 20px; }
        .user-name { font-size: 14px; color: #333; font-weight: 500; }
        .profile-icon { width: 45px; height: 45px; background: linear-gradient(135deg, #CC313D 0%, #F7C5CC 100%); border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55); box-shadow: 0 4px 15px rgba(204, 49, 61, 0.3); position: relative; overflow: hidden; }
        .profile-icon::before { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; border-radius: 50%; background: rgba(255, 255, 255, 0.3); transform: translate(-50%, -50%); transition: width 0.5s, height 0.5s; }
        .profile-icon:hover::before { width: 100%; height: 100%; }
        .profile-icon:hover { transform: rotate(360deg) scale(1.1); box-shadow: 0 6px 25px rgba(204, 49, 61, 0.5); }
        .profile-icon svg { width: 24px; height: 24px; fill: white; z-index: 1; }
        
        /* Dashboard Container - Grid Setup */
        .dashboard-container { max-width: 1400px; margin: 30px auto; padding: 0 24px; display: grid; grid-template-columns: repeat(12, 1fr); gap: 24px; }
        
        /* Widget Base Styles */
        .widget { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); border-radius: 16px; padding: 28px; box-shadow: 0 8px 32px rgba(204, 49, 61, 0.15); transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 2px solid rgba(247, 197, 204, 0.3); animation: fadeInUp 0.6s ease forwards; opacity: 0; position: relative; overflow: hidden; }
        .widget::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(247, 197, 204, 0.1) 0%, transparent 70%); animation: rotate 20s linear infinite; }
        @keyframes rotate { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        .widget:hover { transform: translateY(-8px) scale(1.02); box-shadow: 0 15px 45px rgba(204, 49, 61, 0.25); border-color: #CC313D; }
        .widget-title { font-size: 20px; font-weight: 700; color: #CC313D; margin-bottom: 24px; position: relative; z-index: 1; letter-spacing: -0.5px; }
        .widget-title::after { content: ''; position: absolute; bottom: -8px; left: 0; width: 40px; height: 3px; background: linear-gradient(90deg, #CC313D, #F7C5CC); border-radius: 2px; animation: expandLine 2s ease-in-out infinite; }
        @keyframes expandLine { 0%, 100% { width: 40px; } 50% { width: 60px; } }
        
        /* --- LAYOUT UPDATES --- */

        /* 1. Activity Feed - Top Left (Half Width) */
        .activity-feed { grid-column: 1 / 7; min-height: 300px; }
        .activity-list { display: flex; flex-direction: column; gap: 18px; position: relative; z-index: 1; }
        .activity-item { display: flex; gap: 14px; align-items: flex-start; padding: 12px; border-radius: 10px; transition: all 0.3s ease; animation: fadeIn 0.8s ease forwards; opacity: 0; cursor: pointer; }
        .activity-item:nth-child(1) { animation-delay: 0.1s; }
        .activity-item:nth-child(2) { animation-delay: 0.2s; }
        @keyframes fadeIn { to { opacity: 1; } }
        .activity-item:hover { background: rgba(247, 197, 204, 0.2); transform: translateX(8px); }
        .activity-icon { font-size: 26px; flex-shrink: 0; animation: bounce 1s ease infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        .activity-details { flex: 1; }
        .activity-text { font-size: 14px; font-weight: 600; color: #333; margin-bottom: 6px; }
        .activity-time { font-size: 12px; color: #999; font-weight: 500; }

        /* 2. Talk to Orion - Top Right (Half Width) */
        .talk-to-orion { grid-column: 7 / 13; background: linear-gradient(135deg, #CC313D 0%, #F7C5CC 100%); color: white; cursor: pointer; position: relative; overflow: hidden; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; min-height: 300px; border: none; }
        .talk-to-orion::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: radial-gradient(circle, rgba(255, 255, 255, 0.2) 0%, transparent 70%); animation: rotateOrion 15s linear infinite; }
        @keyframes rotateOrion { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .talk-to-orion:hover { transform: translateY(-10px) scale(1.03); box-shadow: 0 20px 50px rgba(204, 49, 61, 0.5); }
        .orion-icon { font-size: 64px; margin-bottom: 20px; animation: bounceOrion 2s infinite, rotateOrionIcon 3s ease-in-out infinite; z-index: 1; }
        @keyframes bounceOrion { 0%, 100% { transform: translateY(0) scale(1); } 50% { transform: translateY(-15px) scale(1.1); } }
        @keyframes rotateOrionIcon { 0%, 100% { transform: rotate(-10deg); } 50% { transform: rotate(10deg); } }
        .talk-to-orion .widget-title { color: white; margin-bottom: 15px; font-size: 28px; z-index: 1; text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2); }
        .talk-to-orion .widget-title::after { display: none; }
        .orion-description { font-size: 16px; opacity: 0.95; margin-bottom: 20px; font-weight: 500; z-index: 1; }
        .orion-arrow { font-size: 32px; font-weight: bold; z-index: 1; animation: slideArrow 1.5s ease-in-out infinite; }
        @keyframes slideArrow { 0%, 100% { transform: translateX(0); } 50% { transform: translateX(10px); } }

        /* 3. Skills Gap Analysis - Bottom (Full Width) */
        .skills-gap { grid-column: 1 / 13; min-height: 350px; }
        .skills-content { display: grid; grid-template-columns: 1fr 1fr; gap: 35px; margin-bottom: 24px; position: relative; z-index: 1; }
        .skills-subtitle { font-size: 15px; font-weight: 700; color: #CC313D; margin-bottom: 16px; }
        .skill-tags { display: flex; flex-wrap: wrap; gap: 10px; }
        .skill-tag { padding: 8px 16px; border-radius: 25px; font-size: 13px; font-weight: 600; transition: all 0.3s ease; cursor: default; animation: popIn 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55) forwards; opacity: 0; transform: scale(0); }
        .skill-tag:nth-child(1) { animation-delay: 0.3s; }
        .skill-tag:nth-child(2) { animation-delay: 0.4s; }
        .skill-tag:nth-child(3) { animation-delay: 0.5s; }
        @keyframes popIn { to { opacity: 1; transform: scale(1); } }
        .skill-tag:hover { transform: scale(1.1) rotate(2deg); }
        .skill-tag.mastered { background: linear-gradient(135deg, #CC313D 0%, #F7C5CC 100%); color: white; }
        .skill-tag.learning { background: rgba(247, 197, 204, 0.3); color: #CC313D; border: 2px solid #CC313D; }
        
        .btn-primary { padding: 12px 28px; background: linear-gradient(135deg, #CC313D 0%, #F7C5CC 100%); color: white; border: none; border-radius: 30px; cursor: pointer; font-size: 15px; font-weight: 700; font-family: 'Montserrat', sans-serif; transition: all 0.4s ease; box-shadow: 0 4px 15px rgba(204, 49, 61, 0.3); position: relative; z-index: 1; overflow: hidden; }
        .btn-primary::before { content: ''; position: absolute; top: 50%; left: 50%; width: 0; height: 0; border-radius: 50%; background: rgba(255, 255, 255, 0.3); transform: translate(-50%, -50%); transition: width 0.6s, height 0.6s; }
        .btn-primary:hover::before { width: 300px; height: 300px; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(204, 49, 61, 0.4); }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .activity-feed, .talk-to-orion, .skills-gap { grid-column: 1 / 13; }
            .skills-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1 class="logo">Career Advisor</h1>
            <div class="header-right">
                <span class="user-name">Welcome, User</span>
                <div class="profile-icon" id="profileIcon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        
        <!-- SECTION 1: Recent Activity & Talk to Orion -->
        <div class="widget activity-feed">
            <h2 class="widget-title">Recent Activity</h2>
            <div class="activity-list"></div>
        </div>

        <div class="widget talk-to-orion" id="talkToOrion">
            <div class="orion-icon">ðŸ¤–</div>
            <h2 class="widget-title">Talk to Orion</h2>
            <p class="orion-description">Get personalized career guidance & chat now</p>
            <div class="orion-arrow">â†’</div>
        </div>

        <!-- SECTION 2: Skills Gap Analysis -->
        <div class="widget skills-gap">
            <h2 class="widget-title">Skills Gap Analysis</h2>
            <div class="skills-content">
                <div class="skills-column">
                    <h3 class="skills-subtitle">Skills You Have</h3>
                    <div class="skill-tags" id="skillsHaveContainer"></div>
                </div>
                <div class="skills-column">
                    <h3 class="skills-subtitle">Currently Learning Skills</h3>
                    <div class="skill-tags" id="skillsLearningContainer"></div>
                </div>
            </div>
            <!-- REDIRECT -->
            <button class="btn-primary" onclick="window.location.href='/detailed-skill-analysis'">View Detailed Analysis</button>
        </div>

    </div>

    <script>
        function timeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " years ago";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " months ago";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " days ago";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " hours ago";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " minutes ago";
            return "Just now";
        }

        async function loadDashboard() {
            try {
                const response = await fetch('/api/dashboard-data');
                if (response.status === 401) { window.location.href = '/auth'; return; }
                if (response.ok) {
                    const data = await response.json();
                    
                    document.querySelector('.user-name').textContent = `Welcome, ${data.name}`;

                    // Populate Skills
                    const skillsHave = document.getElementById('skillsHaveContainer');
                    skillsHave.innerHTML = data.skills.map(s => `<span class="skill-tag mastered">${s}</span>`).join('') || '<span style="color:#666;font-size:13px;">No skills added</span>';

                    const skillsLearning = document.getElementById('skillsLearningContainer');
                    skillsLearning.innerHTML = data.currently_learning.map(s => `<span class="skill-tag learning">${s}</span>`).join('') || '<span style="color:#666;font-size:13px;">Not learning anything</span>';

                    // Populate Activity
                    const activityList = document.querySelector('.activity-list');
                    if (data.recent_activity.length > 0) {
                        activityList.innerHTML = data.recent_activity.map(a => `
                            <div class="activity-item" onclick="window.location.href='/chat?id=${a.id}'">
                                <div class="activity-icon">ðŸ’¬</div>
                                <div class="activity-details">
                                    <p class="activity-text">Chat: ${a.title}</p>
                                    <span class="activity-time">${timeAgo(a.timestamp)}</span>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        activityList.innerHTML = '<div style="padding:10px; color:#666;">No recent activity.</div>';
                    }
                }
            } catch (error) { console.error("Error loading dashboard:", error); }
        }

        window.addEventListener('load', () => { loadDashboard(); });
        document.getElementById('profileIcon').addEventListener('click', () => window.location.href = '/profile');
        document.getElementById('talkToOrion').addEventListener('click', () => window.location.href = '/chat');
    </script>
</body>
</html>