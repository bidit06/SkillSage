<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Career Advisor Dashboard</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ... (Core Styles) ... */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        /* NEW: Body Background -> #FFFDF6 */
        body { 
            font-family: 'Montserrat', sans-serif; 
            background: #FFFDF6; 
            min-height: 100vh; 
            padding-bottom: 40px; 
            color: #4C5372; /* Default text color to Primary Heading color for readability */
        }
        
        /* Header: Matching Card Background #E2D4E0 */
        .header { 
            background: #E2D4E0; 
            box-shadow: 0 4px 20px rgba(76, 83, 114, 0.1); 
            position: sticky; top: 0; z-index: 100; 
            border-bottom: 1px solid #949AB1; /* Border color */
        }
        .header-content { max-width: 1400px; margin: 0 auto; padding: 20px 30px; display: flex; justify-content: space-between; align-items: center; }
        
        /* Logo: Headings Color -> #4C5372 */
        .logo { 
            font-size: 28px; 
            font-weight: 800; 
            color: #4C5372; 
            letter-spacing: -1px; 
        }
        
        .header-right { display: flex; align-items: center; gap: 20px; }
        .user-name { font-size: 14px; color: #4C5372; font-weight: 600; }
        
        /* Profile Icon: Button Color -> #4C5372 */
        .profile-icon { 
            width: 45px; height: 45px; 
            background: #4C5372; 
            border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            box-shadow: 0 4px 10px rgba(76, 83, 114, 0.2); 
        }
        .profile-icon:hover { transform: scale(1.05); background: #3b4059; }
        .profile-icon svg { width: 24px; height: 24px; fill: #FFFDF6; }
        
        /* Dashboard Container */
        .dashboard-container { max-width: 1400px; margin: 30px auto; padding: 0 24px; display: grid; grid-template-columns: repeat(12, 1fr); gap: 24px; }
        
        /* Widget: Card Background -> #E2D4E0, Border -> #949AB1 */
        .widget { 
            background: #E2D4E0; 
            border-radius: 16px; 
            padding: 28px; 
            box-shadow: 0 8px 32px rgba(76, 83, 114, 0.05); 
            transition: all 0.3s ease; 
            border: 1px solid #949AB1; 
        }
        .widget:hover { transform: translateY(-5px); box-shadow: 0 12px 40px rgba(76, 83, 114, 0.15); border-color: #4C5372; }
        
        /* Widget Title: Headings Color -> #4C5372 */
        .widget-title { 
            font-size: 20px; 
            font-weight: 700; 
            color: #4C5372; 
            margin-bottom: 24px; 
            position: relative; 
        }
        .widget-title::after { 
            content: ''; position: absolute; bottom: -8px; left: 0; width: 40px; height: 3px; 
            background: #949AB1; /* Divider color */
            border-radius: 2px; 
        }
        
        .activity-feed { grid-column: 1 / 7; min-height: 300px; }
        .activity-list { display: flex; flex-direction: column; gap: 18px; }
        
        .activity-item { 
            display: flex; gap: 14px; align-items: flex-start; padding: 12px; 
            border-radius: 10px; transition: all 0.3s ease; cursor: pointer; 
            border-bottom: 1px solid rgba(148, 154, 177, 0.3); /* Subtle divider */
        }
        .activity-item:hover { background: rgba(255, 253, 246, 0.5); transform: translateX(5px); }
        
        /* Icons: Icons/Labels Color -> #7C7E9D */
        .activity-icon { font-size: 26px; flex-shrink: 0; color: #7C7E9D; }
        .activity-details { flex: 1; }
        .activity-text { font-size: 14px; font-weight: 600; color: #4C5372; margin-bottom: 6px; }
        .activity-time { font-size: 12px; color: #7C7E9D; font-weight: 500; }

        /* Talk to Orion: Special Card */
        .talk-to-orion { 
            grid-column: 7 / 13; 
            background: #4C5372; /* Primary CTA Color */
            color: #FFFDF6; 
            cursor: pointer; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; 
            min-height: 300px; 
            border: 1px solid #4C5372;
        }
        .talk-to-orion:hover { background: #3b4059; }
        .talk-to-orion .widget-title { color: #FFFDF6; }
        .talk-to-orion .widget-title::after { background: #949AB1; }
        .orion-icon { font-size: 64px; margin-bottom: 20px; }
        .orion-description { font-size: 16px; opacity: 0.9; margin-bottom: 20px; font-weight: 500; color: #E2D4E0; }
        .orion-arrow { font-size: 32px; font-weight: bold; color: #FFFDF6; }

        /* Skills Gap */
        .skills-gap { grid-column: 1 / 13; min-height: 350px; }
        .skills-content { display: grid; grid-template-columns: 1fr 1fr; gap: 35px; margin-bottom: 24px; }
        .skills-subtitle { font-size: 15px; font-weight: 700; color: #7C7E9D; margin-bottom: 16px; text-transform: uppercase; letter-spacing: 0.5px; }
        .skill-tags { display: flex; flex-wrap: wrap; gap: 10px; }
        
        /* Tags */
        .skill-tag { padding: 8px 16px; border-radius: 25px; font-size: 13px; font-weight: 600; border: 1px solid #949AB1; }
        .skill-tag.mastered { background: #4C5372; color: #FFFDF6; border-color: #4C5372; }
        .skill-tag.learning { background: transparent; color: #4C5372; border-color: #4C5372; }
        
        /* Button: Primary CTA -> #4C5372 */
        .btn-primary { 
            padding: 12px 28px; 
            background: #4C5372; 
            color: #FFFDF6; 
            border: none; border-radius: 30px; cursor: pointer; 
            font-size: 15px; font-weight: 700; 
            transition: background 0.3s;
        }
        .btn-primary:hover { background: #3b4059; }

        /* World Chat Widget */
        .world-chat-widget { 
            grid-column: 1 / 13; min-height: 150px; cursor: pointer; display: flex; align-items: center; justify-content: space-between; gap: 20px; 
            background: #FFFDF6; /* Body bg for contrast inside widget area? Or Card bg? Let's use Card BG but maybe lighter version or just Card BG */
            background: #E2D4E0;
            border: 2px solid #4C5372; 
        }
        .world-chat-widget:hover { background: #dcd0da; }
        .wc-content { flex: 1; z-index: 1; }
        .wc-icon { font-size: 50px; }
        .wc-arrow { font-size: 24px; color: #4C5372; font-weight: 800; }

        @media (max-width: 1024px) {
            .activity-feed, .talk-to-orion, .skills-gap, .world-chat-widget { grid-column: 1 / 13; }
            .skills-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <h1 class="logo" onclick="window.location.href='/dashboard'">Career Advisor</h1>
            <div class="header-right">
                <span class="user-name">Welcome, User</span>
                <div class="profile-icon" id="profileIcon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>
                </div>
            </div>
        </div>
    </header>

    <div class="dashboard-container">
        
        <div class="widget activity-feed">
            <h2 class="widget-title">Recent Activity</h2>
            <div class="activity-list"></div>
        </div>

        <div class="widget talk-to-orion" id="talkToOrion">
            <div class="orion-icon">ü§ñ</div>
            <h2 class="widget-title">Talk to Orion</h2>
            <p class="orion-description">Get personalized career guidance & chat now</p>
            <div class="orion-arrow">‚Üí</div>
        </div>

        <div class="widget skills-gap">
            <h2 class="widget-title">Skills Gap Analysis</h2>
            <div class="skills-content">
                <div class="skills-column">
                    <h3 class="skills-subtitle">Skills You Have</h3>
                    <div class="skill-tags" id="skillsHaveContainer"></div>
                </div>
                <div class="skills-column">
                    <h3 class="skills-subtitle">Currently Learning Skills</h3>
                    <div class="skill-tags" id="skillsLearningContainer"></div>
                </div>
            </div>
            <button class="btn-primary" onclick="window.location.href='/detailed-skill-analysis'">View Detailed Analysis</button>
        </div>

        <div class="widget world-chat-widget" onclick="window.location.href='/world-chat'">
            <div class="wc-icon">üåç</div>
            <div class="wc-content">
                <h2 class="widget-title" style="margin-bottom: 5px;">World Chat</h2>
                <p style="color: #4C5372; font-weight: 500;">Connect with the global community of learners and professionals.</p>
            </div>
            <div class="wc-arrow">‚Üí</div>
        </div>

    </div>

    <script>
        function timeAgo(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const seconds = Math.floor((now - date) / 1000);
            let interval = seconds / 31536000;
            if (interval > 1) return Math.floor(interval) + " years ago";
            interval = seconds / 2592000;
            if (interval > 1) return Math.floor(interval) + " months ago";
            interval = seconds / 86400;
            if (interval > 1) return Math.floor(interval) + " days ago";
            interval = seconds / 3600;
            if (interval > 1) return Math.floor(interval) + " hours ago";
            interval = seconds / 60;
            if (interval > 1) return Math.floor(interval) + " minutes ago";
            return "Just now";
        }

        async function loadDashboard() {
            try {
                const response = await fetch('/api/dashboard-data');
                if (response.status === 401) { window.location.href = '/auth'; return; }
                if (response.ok) {
                    const data = await response.json();
                    
                    document.querySelector('.user-name').textContent = `Welcome, ${data.name}`;

                    // Populate Skills
                    const skillsHave = document.getElementById('skillsHaveContainer');
                    skillsHave.innerHTML = data.skills.map(s => `<span class="skill-tag mastered">${s}</span>`).join('') || '<span style="color:#7C7E9D;font-size:13px;">No skills added</span>';

                    const skillsLearning = document.getElementById('skillsLearningContainer');
                    skillsLearning.innerHTML = data.currently_learning.map(s => `<span class="skill-tag learning">${s}</span>`).join('') || '<span style="color:#7C7E9D;font-size:13px;">Not learning anything</span>';

                    // Populate Activity
                    const activityList = document.querySelector('.activity-list');
                    if (data.recent_activity.length > 0) {
                        activityList.innerHTML = data.recent_activity.map(a => `
                            <div class="activity-item" onclick="window.location.href='/chat?id=${a.id}'">
                                <div class="activity-icon">üí¨</div>
                                <div class="activity-details">
                                    <p class="activity-text">Chat: ${a.title}</p>
                                    <span class="activity-time">${timeAgo(a.timestamp)}</span>
                                </div>
                            </div>
                        `).join('');
                    } else {
                        activityList.innerHTML = '<div style="padding:10px; color:#7C7E9D;">No recent activity.</div>';
                    }
                }
            } catch (error) { console.error("Error loading dashboard:", error); }
        }

        window.addEventListener('load', () => { loadDashboard(); });
        document.getElementById('profileIcon').addEventListener('click', () => window.location.href = '/profile');
        document.getElementById('talkToOrion').addEventListener('click', () => window.location.href = '/chat');
    </script>
</body>
</html>